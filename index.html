<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post-Workshop Learning Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a4d2e; --primary-light: #4f8355; --accent: #ff6b35;
            --accent-light: #ff8c61; --bg: #faf8f5; --surface: #ffffff;
            --text: #2d2d2d; --text-muted: #6b6b6b; --border: #e0ddd8;
            --success: #27ae60; --warning: #f39c12;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
        .bg-pattern { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.03;
            background-image: repeating-linear-gradient(45deg, var(--primary) 0, var(--primary) 1px, transparent 0, transparent 50%),
                            repeating-linear-gradient(-45deg, var(--accent) 0, var(--accent) 1px, transparent 0, transparent 50%);
            background-size: 30px 30px; animation: patternMove 60s linear infinite; }
        @keyframes patternMove { 0% { background-position: 0 0; } 100% { background-position: 100px 100px; } }
        header { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); padding: 2rem 0;
            box-shadow: 0 4px 20px rgba(26, 77, 46, 0.15); position: relative; overflow: hidden; }
        .header-content { max-width: 1200px; margin: 0 auto; padding: 0 2rem; position: relative; z-index: 1;
            display: flex; justify-content: space-between; align-items: center; }
        h1 { font-family: 'Crimson Pro', serif; font-size: 3rem; font-weight: 700; color: white; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2); letter-spacing: -0.02em; }
        .subtitle { color: rgba(255,255,255,0.9); font-size: 1.1rem; }
        .user-info { color: white; text-align: right; }
        .user-name { font-weight: 600; margin-bottom: 0.25rem; }
        .logout-btn { background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);
            padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.875rem; transition: all 0.3s; }
        .logout-btn:hover { background: rgba(255,255,255,0.3); }
        .container { max-width: 1200px; margin: 3rem auto; padding: 0 2rem; }
        .card { background: var(--surface); border-radius: 16px; padding: 2.5rem; margin-bottom: 2rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08); border: 1px solid var(--border); }
        .card h2 { font-family: 'Crimson Pro', serif; font-size: 2rem; color: var(--primary); margin-bottom: 1.5rem;
            position: relative; padding-bottom: 0.5rem; }
        .card h2::after { content: ''; position: absolute; bottom: 0; left: 0; width: 60px; height: 3px;
            background: var(--accent); border-radius: 2px; }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        input, select { width: 100%; padding: 0.875rem 1rem; border: 2px solid var(--border);
            border-radius: 8px; font-size: 1rem; font-family: 'DM Sans', sans-serif; background: var(--bg); }
        input:focus, select:focus { outline: none; border-color: var(--primary); background: white;
            box-shadow: 0 0 0 3px rgba(26, 77, 46, 0.1); }
        .btn { padding: 0.875rem 2rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600;
            cursor: pointer; font-family: 'DM Sans', sans-serif; display: inline-block; text-decoration: none; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(26, 77, 46, 0.3); }
        .btn-accent { background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%); color: white; }
        .btn-secondary { background: var(--border); color: var(--text); }
        .btn-small { padding: 0.5rem 1rem; font-size: 0.875rem; }
        .nav-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-top: 2rem; }
        .nav-card { background: linear-gradient(135deg, var(--surface) 0%, var(--bg) 100%); border: 2px solid var(--border);
            border-radius: 16px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.3s; }
        .nav-card:hover { border-color: var(--primary); transform: translateY(-8px); box-shadow: 0 12px 32px rgba(0,0,0,0.15); }
        .nav-card-icon { font-size: 3rem; margin-bottom: 1rem; }
        .nav-card h3 { font-family: 'Crimson Pro', serif; font-size: 1.5rem; color: var(--primary); margin-bottom: 0.5rem; }
        .nav-card p { color: var(--text-muted); font-size: 0.95rem; }
        .badge { display: inline-block; padding: 0.25rem 0.75rem; background: var(--accent); color: white;
            border-radius: 12px; font-size: 0.75rem; font-weight: 600; margin-top: 0.5rem; }
        .content-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem; margin-top: 2rem; }
        .content-item { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; transition: all 0.3s; }
        .content-item:hover { box-shadow: 0 8px 24px rgba(0,0,0,0.12); transform: translateY(-4px); }
        .content-theme { display: inline-block; padding: 0.25rem 0.75rem; background: var(--bg); border-radius: 20px;
            font-size: 0.75rem; font-weight: 500; color: var(--primary); margin-bottom: 0.75rem; }
        .content-title { font-family: 'Crimson Pro', serif; font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; }
        .content-meta { display: flex; align-items: center; gap: 1rem; margin: 0.75rem 0; font-size: 0.875rem;
            color: var(--text-muted); flex-wrap: wrap; }
        .content-actions { margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .completed-badge { display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.25rem 0.75rem;
            background: var(--success); color: white; border-radius: 12px; font-size: 0.75rem; font-weight: 600; margin-top: 0.5rem; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7);
            z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 2rem; }
        .modal-content { background: var(--surface); border-radius: 16px; max-width: 600px; width: 100%; padding: 2.5rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3); position: relative; }
        .close-btn { position: absolute; top: 1.5rem; right: 1.5rem; background: var(--border); border: none;
            width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 1.25rem; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin: 2rem 0; }
        .stat-card { background: linear-gradient(135deg, var(--surface) 0%, var(--bg) 100%); padding: 1.5rem;
            border-radius: 12px; border: 1px solid var(--border); text-align: center; }
        .stat-value { font-size: 2.5rem; font-weight: 700; color: var(--primary); font-family: 'Crimson Pro', serif; }
        .stat-label { color: var(--text-muted); font-size: 0.875rem; margin-top: 0.5rem; }
        .back-btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: var(--border);
            border: none; border-radius: 8px; cursor: pointer; margin-bottom: 1.5rem; }
        .back-btn:hover { background: var(--text-muted); color: white; }
        .alert { padding: 1rem 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .alert-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .hidden { display: none !important; }
        .loading { text-align: center; padding: 2rem; color: var(--text-muted); }
        .spinner { border: 3px solid var(--border); border-top: 3px solid var(--primary); border-radius: 50%;
            width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 2rem auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .auth-container { max-width: 500px; margin: 4rem auto; }
        .auth-tabs { display: flex; gap: 1rem; margin-bottom: 2rem; }
        .auth-tab { flex: 1; padding: 1rem; background: var(--bg); border: 2px solid var(--border); border-radius: 8px;
            cursor: pointer; text-align: center; font-weight: 600; transition: all 0.3s; }
        .auth-tab.active { background: var(--primary); color: white; border-color: var(--primary); }
        .password-toggle { position: absolute; right: 1rem; top: 50%; transform: translateY(-50%);
            cursor: pointer; color: var(--text-muted); }
        .form-group { position: relative; }
        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .header-content { flex-direction: column; text-align: center; gap: 1rem; }
            .container { padding: 0 1rem; }
            .card { padding: 1.5rem; }
            .content-grid, .nav-buttons { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>
    
    <header>
        <div class="header-content">
            <div>
                <h1>üå± Learning Portal</h1>
                <p class="subtitle">Interactive Learning Platform</p>
            </div>
            <div class="user-info hidden" id="user-info">
                <div class="user-name" id="header-user-name"></div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Authentication Screen -->
        <div id="auth-screen" class="auth-container">
            <div class="card">
                <h2>Welcome! üëã</h2>
                <div class="auth-tabs">
                    <div class="auth-tab active" onclick="switchTab('signin')">Sign In</div>
                    <div class="auth-tab" onclick="switchTab('signup')">Sign Up</div>
                </div>

                <!-- Sign In Form -->
                <form id="signin-form">
                    <div class="form-group">
                        <label for="signin-email">Email Address *</label>
                        <input type="email" id="signin-email" required placeholder="your.email@example.com">
                    </div>
                    <div class="form-group">
                        <label for="signin-password">Password *</label>
                        <input type="password" id="signin-password" required placeholder="Enter your password">
                        <span class="password-toggle" onclick="togglePassword('signin-password')">üëÅÔ∏è</span>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Sign In</button>
                    <p style="text-align: center; margin-top: 1rem; color: var(--text-muted); font-size: 0.875rem;">
                        Don't have an account? <a href="#" onclick="switchTab('signup'); return false;" style="color: var(--primary);">Sign Up</a>
                    </p>
                </form>

                <!-- Sign Up Form -->
                <form id="signup-form" class="hidden">
                    <div class="form-group">
                        <label for="signup-name">Full Name *</label>
                        <input type="text" id="signup-name" required placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label for="signup-email">Email Address *</label>
                        <input type="email" id="signup-email" required placeholder="your.email@example.com">
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Password *</label>
                        <input type="password" id="signup-password" required placeholder="Create a password (min 6 characters)" minlength="6">
                        <span class="password-toggle" onclick="togglePassword('signup-password')">üëÅÔ∏è</span>
                    </div>
                    <div class="form-group">
                        <label for="signup-institution">Institution/Organization *</label>
                        <input type="text" id="signup-institution" required placeholder="Your institution name">
                    </div>
                    <div class="form-group">
                        <label for="signup-cohort">Cohort/Batch</label>
                        <input type="text" id="signup-cohort" placeholder="e.g., Spring 2024">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Create Account</button>
                    <p style="text-align: center; margin-top: 1rem; color: var(--text-muted); font-size: 0.875rem;">
                        Already have an account? <a href="#" onclick="switchTab('signin'); return false;" style="color: var(--primary);">Sign In</a>
                    </p>
                </form>
            </div>
        </div>

        <!-- Dashboard (same as before) -->
        <div id="dashboard-screen" class="hidden">
            <div class="card">
                <h2>Welcome back, <span id="user-name-display"></span>! üëã</h2>
                <p style="color: var(--text-muted); margin-bottom: 2rem;">Choose your learning path below</p>
                <div class="nav-buttons">
                    <div class="nav-card" onclick="showVideosSection()">
                        <div class="nav-card-icon">üé¨</div>
                        <h3>Videos to Watch</h3>
                        <p>Explore 44 curated videos</p>
                        <span class="badge">44 Videos</span>
                    </div>
                    <div class="nav-card" onclick="showArticlesSection()">
                        <div class="nav-card-icon">üìö</div>
                        <h3>Articles to Read</h3>
                        <p>Read 7 insightful articles</p>
                        <span class="badge">7 Articles</span>
                    </div>
                    <div class="nav-card" onclick="showProgressSection()">
                        <div class="nav-card-icon">üìä</div>
                        <h3>My Progress</h3>
                        <p>Track your learning journey</p>
                        <span class="badge" id="progress-badge">0 Completed</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Videos Section -->
        <div id="videos-section" class="hidden">
            <button class="back-btn" onclick="backToDashboard()">‚Üê Back</button>
            <div class="card">
                <h2>Videos to Watch</h2>
                <div class="form-group">
                    <label for="video-filter">Filter by Theme</label>
                    <select id="video-filter" onchange="filterVideos()">
                        <option value="all">All Themes (44 videos)</option>
                    </select>
                </div>
                <div id="videos-grid" class="content-grid"></div>
            </div>
        </div>

        <!-- Articles Section -->
        <div id="articles-section" class="hidden">
            <button class="back-btn" onclick="backToDashboard()">‚Üê Back</button>
            <div class="card">
                <h2>Articles to Read</h2>
                <div class="form-group">
                    <label for="article-filter">Filter by Theme</label>
                    <select id="article-filter" onchange="filterArticles()">
                        <option value="all">All Themes (7 articles)</option>
                    </select>
                </div>
                <div id="articles-grid" class="content-grid"></div>
            </div>
        </div>

        <!-- Progress Section -->
        <div id="progress-section" class="hidden">
            <button class="back-btn" onclick="backToDashboard()">‚Üê Back</button>
            <div class="card">
                <h2>My Learning Progress</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="videos-completed">0</div>
                        <div class="stat-label">Videos Watched</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="articles-completed">0</div>
                        <div class="stat-label">Articles Read</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="quizzes-completed">0</div>
                        <div class="stat-label">Quizzes Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-progress">0%</div>
                        <div class="stat-label">Overall Completion</div>
                    </div>
                </div>
                <h3 style="margin-top: 2rem; color: var(--primary);">Completed Content</h3>
                <div id="progress-details"></div>
            </div>
        </div>
    </div>

    <!-- Quiz Modal -->
    <div id="quiz-modal" class="hidden modal-overlay" onclick="closeQuizIfClickedOutside(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="close-btn" onclick="closeQuiz()">√ó</button>
            <h2 id="quiz-title">Complete Quiz</h2>
            <div id="quiz-body"></div>
        </div>
    </div>

    <script src="content-data.js"></script>
    <script>
        // Google Sheets Configuration
        const GOOGLE_SHEETS_CONFIG = {
            WEB_APP_URL: 'YOUR_GOOGLE_SHEETS_WEB_APP_URL_HERE', // Replace with your deployed Google Apps Script URL
            enabled: false // Set to true once you've deployed the Google Apps Script
        };

        // Application State
        let currentUser = null;
        let allUsers = {};

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadUsersFromStorage();
            checkAuth();
            populateFilters();
        });

        // Auth Tab Switching
        function switchTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            if (tab === 'signin') {
                event.target.classList.add('active');
                document.getElementById('signin-form').classList.remove('hidden');
                document.getElementById('signup-form').classList.add('hidden');
            } else {
                document.querySelectorAll('.auth-tab')[1].classList.add('active');
                document.getElementById('signin-form').classList.add('hidden');
                document.getElementById('signup-form').classList.remove('hidden');
            }
        }

        // Password Toggle
        function togglePassword(fieldId) {
            const field = document.getElementById(fieldId);
            field.type = field.type === 'password' ? 'text' : 'password';
        }

        // Sign Up
        document.getElementById('signup-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const name = document.getElementById('signup-name').value;
            const institution = document.getElementById('signup-institution').value;
            const cohort = document.getElementById('signup-cohort').value;

            // Check if user exists
            if (allUsers[email]) {
                alert('‚ùå An account with this email already exists. Please sign in.');
                return;
            }

            // Create user
            const userData = {
                email: email,
                password: btoa(password), // Simple encoding (use proper hashing in production)
                name: name,
                institution: institution,
                cohort: cohort || 'Not specified',
                registeredAt: new Date().toISOString(),
                progress: {
                    videosWatched: [],
                    articlesRead: [],
                    quizzesCompleted: []
                }
            };

            allUsers[email] = userData;
            saveUsersToStorage();

            // Send to Google Sheets
            await sendToGoogleSheets({
                action: 'USER_REGISTRATION',
                data: {
                    email: email,
                    name: name,
                    institution: institution,
                    cohort: cohort,
                    registeredAt: userData.registeredAt
                }
            });

            alert('‚úÖ Account created successfully! Please sign in.');
            switchTab('signin');
            document.getElementById('signin-email').value = email;
        });

        // Sign In
        document.getElementById('signin-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('signin-email').value;
            const password = document.getElementById('signin-password').value;

            const user = allUsers[email];
            if (!user) {
                alert('‚ùå No account found with this email. Please sign up first.');
                return;
            }

            if (user.password !== btoa(password)) {
                alert('‚ùå Incorrect password. Please try again.');
                return;
            }

            // Successful login
            currentUser = user;
            saveCurrentUser();
            showDashboard();
        });

        // Logout
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                localStorage.removeItem('currentUser');
                location.reload();
            }
        }

        // Check Authentication
        function checkAuth() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                const email = savedUser;
                currentUser = allUsers[email];
                if (currentUser) {
                    showDashboard();
                } else {
                    showAuth();
                }
            } else {
                showAuth();
            }
        }

        function showAuth() {
            document.getElementById('auth-screen').classList.remove('hidden');
            document.getElementById('dashboard-screen').classList.add('hidden');
            document.getElementById('user-info').classList.add('hidden');
        }

        function showDashboard() {
            document.getElementById('auth-screen').classList.add('hidden');
            hideAllSections();
            document.getElementById('dashboard-screen').classList.remove('hidden');
            document.getElementById('user-info').classList.remove('hidden');
            document.getElementById('user-name-display').textContent = currentUser.name;
            document.getElementById('header-user-name').textContent = currentUser.name;
            updateProgressBadge();
        }

        function hideAllSections() {
            document.querySelectorAll('.container > div:not(#auth-screen)').forEach(div => div.classList.add('hidden'));
        }

        function backToDashboard() {
            showDashboard();
        }

        function updateProgressBadge() {
            const total = currentUser.progress.videosWatched.length + currentUser.progress.articlesRead.length;
            document.getElementById('progress-badge').textContent = total + ' Completed';
        }

        // Storage Functions
        function saveCurrentUser() {
            localStorage.setItem('currentUser', currentUser.email);
            allUsers[currentUser.email] = currentUser;
            saveUsersToStorage();
        }

        function loadUsersFromStorage() {
            const saved = localStorage.getItem('allUsers');
            if (saved) {
                allUsers = JSON.parse(saved);
            }
        }

        function saveUsersToStorage() {
            localStorage.setItem('allUsers', JSON.stringify(allUsers));
        }

        // Google Sheets Integration
        async function sendToGoogleSheets(payload) {
            if (!GOOGLE_SHEETS_CONFIG.enabled) {
                console.log('Google Sheets not configured. Data:', payload);
                return;
            }

            try {
                const response = await fetch(GOOGLE_SHEETS_CONFIG.WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                console.log('‚úÖ Data sent to Google Sheets');
            } catch (error) {
                console.error('‚ùå Error sending to Google Sheets:', error);
            }
        }

        // Populate Filters
        function populateFilters() {
            const videoThemes = [...new Set(contentData.videos.map(v => v.theme))].filter(Boolean);
            const articleThemes = [...new Set(contentData.articles.map(a => a.theme))].filter(Boolean);
            
            const videoFilter = document.getElementById('video-filter');
            videoThemes.forEach(theme => {
                const count = contentData.videos.filter(v => v.theme === theme).length;
                const option = document.createElement('option');
                option.value = theme;
                option.textContent = theme + ' (' + count + ')';
                videoFilter.appendChild(option);
            });

            const articleFilter = document.getElementById('article-filter');
            articleThemes.forEach(theme => {
                const count = contentData.articles.filter(a => a.theme === theme).length;
                const option = document.createElement('option');
                option.value = theme;
                option.textContent = theme + ' (' + count + ')';
                articleFilter.appendChild(option);
            });
        }

        // Show Videos
        function showVideosSection() {
            hideAllSections();
            document.getElementById('videos-section').classList.remove('hidden');
            renderVideos();
        }

        function renderVideos(filter = 'all') {
            const grid = document.getElementById('videos-grid');
            grid.innerHTML = '';
            
            const filteredVideos = filter === 'all' ? contentData.videos : contentData.videos.filter(v => v.theme === filter);
            
            filteredVideos.forEach(video => {
                const isWatched = currentUser?.progress?.videosWatched?.includes(video.id);
                const hasQuiz = video.quiz_link && video.quiz_link !== 'None' && video.quiz_link !== null;
                
                const card = document.createElement('div');
                card.className = 'content-item';
                card.innerHTML = `
                    <span class="content-theme">${video.theme || 'General'}</span>
                    <h3 class="content-title">${video.title}</h3>
                    <div class="content-meta">
                        <span>‚è±Ô∏è ${video.duration}</span>
                        ${hasQuiz ? '<span>üìù Quiz Available</span>' : '<span>‚ÑπÔ∏è No Quiz</span>'}
                    </div>
                    <div class="content-actions">
                        <a href="${video.link}" target="_blank" class="btn btn-small btn-accent" onclick="markAsWatched('video', ${video.id})">Watch Video ‚Üí</a>
                        ${hasQuiz ? `<a href="${video.quiz_link}" target="_blank" class="btn btn-small btn-primary" onclick="markQuizCompleted('video', ${video.id})">Take Quiz ‚Üí</a>` : ''}
                    </div>
                    ${isWatched ? '<span class="completed-badge">‚úì Watched</span>' : ''}
                `;
                grid.appendChild(card);
            });
        }

        function filterVideos() {
            renderVideos(document.getElementById('video-filter').value);
        }

        // Show Articles
        function showArticlesSection() {
            hideAllSections();
            document.getElementById('articles-section').classList.remove('hidden');
            renderArticles();
        }

        function renderArticles(filter = 'all') {
            const grid = document.getElementById('articles-grid');
            grid.innerHTML = '';
            
            const filteredArticles = filter === 'all' ? contentData.articles : contentData.articles.filter(a => a.theme === filter);
            
            filteredArticles.forEach(article => {
                const isRead = currentUser?.progress?.articlesRead?.includes(article.id);
                const hasQuiz = article.quiz_link && article.quiz_link !== 'None' && article.quiz_link !== '-' && article.quiz_link !== null && !String(article.quiz_link).includes('Present in Case Study');
                
                const card = document.createElement('div');
                card.className = 'content-item';
                card.innerHTML = `
                    <span class="content-theme">${article.theme || 'General'}</span>
                    <h3 class="content-title">${article.title}</h3>
                    <div class="content-meta">
                        <span>‚è±Ô∏è ${article.duration || 'Varies'}</span>
                        ${hasQuiz ? '<span>üìù Assignment Available</span>' : '<span>‚ÑπÔ∏è No Assignment</span>'}
                    </div>
                    <div class="content-actions">
                        <a href="${article.link}" target="_blank" class="btn btn-small btn-accent" onclick="markAsRead('article', ${article.id})">Read Article ‚Üí</a>
                        ${hasQuiz ? `<a href="${article.quiz_link}" target="_blank" class="btn btn-small btn-primary" onclick="markQuizCompleted('article', ${article.id})">Complete Assignment ‚Üí</a>` : ''}
                    </div>
                    ${isRead ? '<span class="completed-badge">‚úì Read</span>' : ''}
                `;
                grid.appendChild(card);
            });
        }

        function filterArticles() {
            renderArticles(document.getElementById('article-filter').value);
        }

        // Mark as Watched/Read
        async function markAsWatched(type, id) {
            if (!currentUser.progress.videosWatched.includes(id)) {
                currentUser.progress.videosWatched.push(id);
                saveCurrentUser();
                
                const video = contentData.videos.find(v => v.id === id);
                await sendToGoogleSheets({
                    action: 'VIDEO_WATCHED',
                    data: {
                        email: currentUser.email,
                        name: currentUser.name,
                        videoId: id,
                        videoTitle: video.title,
                        timestamp: new Date().toISOString()
                    }
                });
                
                setTimeout(() => {
                    renderVideos(document.getElementById('video-filter').value);
                    updateProgressBadge();
                }, 100);
            }
        }

        async function markAsRead(type, id) {
            if (!currentUser.progress.articlesRead.includes(id)) {
                currentUser.progress.articlesRead.push(id);
                saveCurrentUser();
                
                const article = contentData.articles.find(a => a.id === id);
                await sendToGoogleSheets({
                    action: 'ARTICLE_READ',
                    data: {
                        email: currentUser.email,
                        name: currentUser.name,
                        articleId: id,
                        articleTitle: article.title,
                        timestamp: new Date().toISOString()
                    }
                });
                
                setTimeout(() => {
                    renderArticles(document.getElementById('article-filter').value);
                    updateProgressBadge();
                }, 100);
            }
        }

        async function markQuizCompleted(type, id) {
            const quizKey = type + '-' + id;
            if (!currentUser.progress.quizzesCompleted.includes(quizKey)) {
                currentUser.progress.quizzesCompleted.push(quizKey);
                
                if (type === 'video' && !currentUser.progress.videosWatched.includes(id)) {
                    currentUser.progress.videosWatched.push(id);
                } else if (type === 'article' && !currentUser.progress.articlesRead.includes(id)) {
                    currentUser.progress.articlesRead.push(id);
                }
                
                saveCurrentUser();
                
                const content = type === 'video' 
                    ? contentData.videos.find(v => v.id === id)
                    : contentData.articles.find(a => a.id === id);
                
                await sendToGoogleSheets({
                    action: 'QUIZ_COMPLETED',
                    data: {
                        email: currentUser.email,
                        name: currentUser.name,
                        contentType: type,
                        contentId: id,
                        contentTitle: content.title,
                        timestamp: new Date().toISOString()
                    }
                });
                
                updateProgressBadge();
            }
        }

        // Progress Section
        function showProgressSection() {
            hideAllSections();
            document.getElementById('progress-section').classList.remove('hidden');
            
            const videosCount = currentUser.progress.videosWatched.length;
            const articlesCount = currentUser.progress.articlesRead.length;
            const quizzesCount = currentUser.progress.quizzesCompleted.length;
            const totalContent = contentData.videos.length + contentData.articles.length;
            const completedContent = videosCount + articlesCount;
            const progressPercent = Math.round((completedContent / totalContent) * 100);
            
            document.getElementById('videos-completed').textContent = videosCount;
            document.getElementById('articles-completed').textContent = articlesCount;
            document.getElementById('quizzes-completed').textContent = quizzesCount;
            document.getElementById('total-progress').textContent = progressPercent + '%';
            
            let detailsHTML = '<div class="content-grid" style="margin-top: 1.5rem;">';
            
            currentUser.progress.videosWatched.forEach(id => {
                const video = contentData.videos.find(v => v.id === id);
                if (video) {
                    const quizCompleted = currentUser.progress.quizzesCompleted.includes('video-' + id);
                    detailsHTML += `
                        <div class="content-item">
                            <span class="content-theme">Video</span>
                            <h3 class="content-title">${video.title}</h3>
                            <div class="content-meta"><span>‚è±Ô∏è ${video.duration}</span></div>
                            <span class="completed-badge">‚úì Watched</span>
                            ${quizCompleted ? '<span class="completed-badge">‚úì Quiz Done</span>' : ''}
                        </div>
                    `;
                }
            });
            
            currentUser.progress.articlesRead.forEach(id => {
                const article = contentData.articles.find(a => a.id === id);
                if (article) {
                    const quizCompleted = currentUser.progress.quizzesCompleted.includes('article-' + id);
                    detailsHTML += `
                        <div class="content-item">
                            <span class="content-theme">Article</span>
                            <h3 class="content-title">${article.title}</h3>
                            <div class="content-meta"><span>‚è±Ô∏è ${article.duration || 'Varies'}</span></div>
                            <span class="completed-badge">‚úì Read</span>
                            ${quizCompleted ? '<span class="completed-badge">‚úì Assignment Done</span>' : ''}
                        </div>
                    `;
                }
            });
            
            if (completedContent === 0) {
                detailsHTML = '<p style="text-align: center; color: var(--text-muted); margin: 2rem 0;">No content completed yet. Start watching videos or reading articles!</p>';
            } else {
                detailsHTML += '</div>';
            }
            
            document.getElementById('progress-details').innerHTML = detailsHTML;
        }

        function closeQuiz() {}
        function closeQuizIfClickedOutside() {}

        console.log('%cüå± Workshop Learning Portal with Authentication', 'color: #1a4d2e; font-size: 20px; font-weight: bold;');
    </script>
</body>
</html>
